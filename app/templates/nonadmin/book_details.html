{% extends "nonadmin/layout.html" %} {% block body %}

<div class="books-display-content px-3 pt-4">
	<div class="book-info d-flex bg-light py-3 px-3">
		{% if book %}
		<img
			src="{{ url_for('static', filename='images/createthumb.jpeg') }}"
			class="rounded"
		/>
		<div class="book-desc col-md-10 ps-4">
			<h3 class="text-success">{{ book.title }}</h3>
			<p class="text-danger">Writer: {{ book.writer }}</p>
			<p>Description: {{ book.description }}</p>
		</div>
		{% endif %}
	</div>
</div>

<div class="personal-review px-3 pt-4">
	<div class="card rounded">
		{% if user_review %}
		<div class="card-header mb-3">Your Review</div>
		<div class="card-body" id="review-display">
			<div class="d-flex justify-content-between">
				<h2 class="card-title">Rating</h2>
				<div class="text-end">
					<button
						class="btn btn-outline-danger btn-sm"
						id="review-edit-button"
					>
						Edit
					</button>
				</div>
			</div>
			<h2 class="--bs-danger-text-emphasis">
				{{ user_review.rating }}/5
			</h2>
			<br />
			<p class="card-text">{{ user_review.review }}</p>
		</div>
		<form
			method="POST"
			action="/edit-review/{{ book.title }}/{{ book.book_id }}"
			id="edit-review-form"
			style="display: none"
		>
			<label for="rating">Rating:</label>
			<input
				type="number"
				name="rating"
				id="rating"
				value="{{ user_review.rating }}"
			/>

			<label for="review">Review:</label>
			<textarea name="review" id="review">
{{ user_review.review }}</textarea
			>

			<button type="submit">Update Review</button>
		</form>
		<button id="review-cancel-button" style="display: none">Cancel</button>
	</div>

	{% else %}
	<div class="card-header mb-3">Add Your Review</div>
	<form
		method="POST"
		action="/add-review/{{ book.title }}/{{ book.book_id }}"
	>
		<label for="rating">Rating:</label>
		<input type="number" name="rating" id="rating" />

		<label for="review">Review:</label>
		<textarea name="review"></textarea>

		<button type="submit">Add Review</button>
	</form>
	{% endif %}
</div>

<div class="all-reviews px-3 pt-4">
	<h1 class="mb-3">Reviews</h1>
	{% for review in ratings_reviews %} {% if review.User.nomor_induk !=
	session.get('nim') %}
	<div class="card rounded text-bg-dark mb-3" style="max-width: 18rem">
		<div class="card-header">{{ review.User.name }}</div>
		<div class="card-body">
			<h5 class="card-title">{{ review.RatingReview.rating }}</h5>
			<p class="card-text">{{ review.RatingReview.review }}</p>
		</div>
	</div>
	{% endif %} {% endfor %}
</div>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		var reviewEditButton = document.getElementById("review-edit-button");
		var reviewDisplay = document.getElementById("review-display");
		var editReviewForm = document.getElementById("edit-review-form");
		var reviewCancelButton = document.getElementById(
			"review-cancel-button"
		);

		reviewEditButton.addEventListener("click", function () {
			reviewDisplay.style.display = "none";
			editReviewForm.style.display = "block";
			reviewEditButton.style.display = "none";
			reviewCancelButton.style.display = "block";
		});

		reviewCancelButton.addEventListener("click", function () {
			reviewDisplay.style.display = "block";
			editReviewForm.style.display = "none";
			reviewEditButton.style.display = "block";
			reviewCancelButton.style.display = "none";
		});
	});
</script>

{% endblock %}
